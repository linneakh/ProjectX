---
title: "Deseq2"
author: "Linnea Honeker"
date: "4/6/2022"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library("DESeq2")
packageVersion("DESeq2")
library(dplyr)
library(knitr)
library(apeglm)
library("ggplot2")
library("pheatmap")
library("stringr")
library(tidyverse)
library(cowplot)
library(reshape2)
library(heatmaply)

col_list2 = c("#2ECC71" ,"#F39C12")
```

# WGCNA analysis of soil pyruvate metatranscriptomic data. 

```{r load_data}
#import count data, transform to matrix, import column metadata, check that its a data.frame
cts.0 <- read.csv("../../Data/Deseq2/Drought_vs_predrought_metaT_gene_copy.csv", header = TRUE, sep =",")
coldata <- read.csv("../../Data/Deseq2/metaT-metadata.csv", header = TRUE, sep = ",")
cts.02 <- as.matrix(cts.0)
row.names(cts.02) <- cts.02[,1]
cts.02 <- cts.02[,-1]

cts <- matrix(as.numeric(cts.02),    # Convert to numeric matrix
                  ncol = ncol(cts.02))
cts.0$Feature = NULL
colnames(cts) <- colnames(cts.0)

row.names(cts) <- row.names(cts.02)

row.names(coldata) <- coldata$SampleID
coldata$SampleID <- NULL
```

## Drought vs. Pre-drought across all timepoints post pyruvate addition (0, 6, and 48 hr)
### Step 1
Create deseq2 object to compare drought vs pre-drought across all time points

```{r create_deseq2_object_drought_vs_predrought}

###create a deseq2 object with Condition, Time, and Site as design###
coldata$Condition <- factor(coldata$Condition, c("PreDrought", "Drought"))

coldata$Condition <- relevel(coldata$Condition, ref = "PreDrought")


dds <- DESeqDataSetFromMatrix(countData = cts,
                              colData = coldata,
                              design= ~ Condition + Site)
```

### Step 2
Explore data using variance stabilization normalization (VST) transformation

```{r data_exploration}
vstcounts <- vst(dds, blind=TRUE)
vst.export<- assay(vstcounts)
vst.export<- as.data.frame(vst.export)
write.csv(vst.export, "../../Output/Deseq2/vst-metaT.csv")

plotPCA(vstcounts, intgroup=c("Condition"))

select <- order(rowMeans(counts(dds)),
                decreasing=TRUE)[1:500]

df <- as.data.frame(colData(dds)[,c("Condition","Site")])

pheatmap(assay(vstcounts)[select,], cluster_rows=TRUE, show_rownames=TRUE,
         cluster_cols=TRUE, annotation_col=df)

```

### Step 3
Run Deseq2 on object to find differential gene expression. Here we are comparing drought vs. pre-drought across all time points

```{r DE_analysis_drought_vs_predrought}
dds <- DESeq(dds)
resultsNames(dds) # lists the coefficients

##drought vs predrought time 0
res <- results(dds, contrast = c("Condition","Drought","PreDrought"))
plotMA(res, ylim=c(-40,40))

summary(res)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-10,30), ylim=c(0,20)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
#shrink effect size
resLFC <- lfcShrink(dds, coef="Condition_Drought_vs_PreDrought", type="apeglm")
resLFC
plotMA(resLFC, ylim=c(-2,2))

summary(resLFC)

#make volcano plot
#reset par
par(mfrow=c(1,1))

# Make a basic volcano plot
with(resLFC, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-11,10), ylim=c(0,22)))
with(subset(resLFC, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r export_results_drought_vs_predrought, include=FALSE}
#export results
write.csv(as.data.frame(res), 
          file="../Output/Deseq2/drought-vs-predrought.csv")
write.csv(as.data.frame(resLFC),
          file="../Output/Deseq2/drought-vs-predrought-lfc.csv")
```

## Drought vs. Pre-drought across different time points. Here, pre-drought 0hr is set as reference.)
### Step 1
Create deseq2 object 

```{r create_deseq2_object_ref_predrought0}
###create a deseq2 object with Condition, Time, and Site as design###
coldata$Condition_Time <- factor(coldata$Condition_Time, c("PreDrought_0hr", "PreDrought_6hr", "PreDrought_48hr",
                                                           "Drought_0hr", "Drought_6hr", "Drought_48hr"))

coldata$Condition_Time <- relevel(coldata$Condition_Time, ref = "PreDrought_0hr")


dds.pt0 <- DESeqDataSetFromMatrix(countData = cts,
                              colData = coldata,
                              design= ~ Condition_Time + Site)

```

### Step 2
Explore data using variance stabilization normalization (VST) transformation

```{r data_exploration_drought_vs_predrought}

vstcounts <- vst(dds.pt0, blind=TRUE)
vst.export<- assay(vstcounts)
vst.export<- as.data.frame(vst.export)

plotPCA(vstcounts, intgroup=c("Condition_Time"))

select <- order(rowMeans(counts(dds)),
                decreasing=TRUE)[1:500]
df <- as.data.frame(colData(dds.pt0)[,c("Condition_Time","Site")])


pheatmap(assay(vstcounts)[select,], cluster_rows=TRUE, show_rownames=TRUE,
         cluster_cols=TRUE, annotation_col=df)

```

### Step 3a
Run Deseq2 on object to find differential gene expression. Here we are comparing Drought 0hr vs Pre-drought 0hr

```{r DE_analysis_drought_0hr_vs_predrought_0hr}
###deifferential expression analysis###

dds.pt0.T0 <- DESeq(dds.pt0)
resultsNames(dds.pt0.T0) # lists the coefficients

##drought vs predrought time 0
res.T0 <- results(dds.pt0.T0, contrast = c("Condition_Time","Drought_0hr","PreDrought_0hr"))
plotMA(res.T0, ylim=c(-40,40))

summary(res.T0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.T0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.T0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.T0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))


```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
#shrink effect size
resLFC.T0 <- lfcShrink(dds.pt0.T0, coef="Condition_Time_Drought_0hr_vs_PreDrought_0hr", type="apeglm")
resLFC.T0
plotMA(resLFC.T0, ylim=c(-2,2))

summary(resLFC.T0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.T0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.T0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.T0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r export_results_drought_0hr_vs_predrought_0hr, include=FALSE}
write.csv(as.data.frame(res.T0), 
          file="../Output/Deseq2/drought-0hr-vs-predrought-0hr.csv")
write.csv(as.data.frame(resLFC.T0),
          file="../Output/Deseq2/drought-0hr-vs-predrought-0hr-lfc.csv")
```


### Step 3a
Extract differential gene expression for Pre-drought 6 hr vs Pre-drought 0hr
```{r}
res.pd.6.0 <- results(dds.pt0.T0, contrast = c("Condition_Time","PreDrought_6hr","PreDrought_0hr"))
plotMA(res.pd.6.0, ylim=c(-40,40))

summary(res.pd.6.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.pd.6.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.pd.6.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.pd.6.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
resLFC.pd.6.0 <- lfcShrink(dds.pt0.T0, coef="Condition_Time_PreDrought_6hr_vs_PreDrought_0hr", type="apeglm")
resLFC.pd.6.0
plotMA(resLFC.pd.6.0, ylim=c(-2,2))

summary(resLFC.pd.6.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.pd.6.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.pd.6.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.pd.6.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r}
#export results
write.csv(as.data.frame(res.pd.6.0), 
          file="../Output/Deseq2/predrought-6hr-vs-predrought-0hr.csv")
write.csv(as.data.frame(resLFC.pd.6.0),
          file="../Output/Deseq2/predrought-6hr-vs-predrought-0hr-lfc.csv")
```

## Within predrought, 48 hr compared to 0hr  (Here preDrought 0h is still set as reference, so skip to step 3a)
### Step 3a
Extract differential gene expression for comparing Dprerought 48hr vs preDrought 0hr

```{r}
#dds <- DESeq(dds)
#resultsNames(dds) # lists the coefficients

res.pd.48.0 <- results(dds.pt0.T0, contrast = c("Condition_Time","PreDrought_48hr","PreDrought_0hr"))
plotMA(res.pd.48.0, ylim=c(-40,40))

summary(res.pd.48.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.pd.48.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.pd.48.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.pd.48.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
resLFC.pd.48.0 <- lfcShrink(dds.pt0.T0, coef="Condition_Time_PreDrought_48hr_vs_PreDrought_0hr", type="apeglm")
resLFC.pd.48.0
plotMA(resLFC.pd.48.0, ylim=c(-2,2))

summary(resLFC.pd.48.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.pd.48.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.pd.48.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.pd.48.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```


```{r}

#export results
write.csv(as.data.frame(res.pd.48.0), 
          file="../Output/Deseq2/predrought-48hr-vs-predrought-0hr.csv")
write.csv(as.data.frame(resLFC.pd.48.0),
          file="../Output/Deseq2/predrought-48hr-vs-predrought-0hr-lfc.csv")
```



## Drought vs. Pre-drought across different time points. (Here, pre-drought 6hr is set as reference.)
### Step 1
Create deseq2 object 
 
```{r}
###create a deseq2 object with Condition, Time, and Site as design###
coldata$Condition_Time <- factor(coldata$Condition_Time, c("PreDrought_0hr", "PreDrought_6hr", "PreDrought_48hr",
                                                           "Drought_0hr", "Drought_6hr", "Drought_48hr"))

coldata$Condition_Time <- relevel(coldata$Condition_Time, ref = "PreDrought_6hr")


dds.pt6 <- DESeqDataSetFromMatrix(countData = cts,
                              colData = coldata,
                              design= ~ Condition_Time + Site)
```


### Step 3a (Skip step 2, data exploration, because already performed above)
Run Deseq2 on object to find differential gene expression. Here we are comparing Drought 0hr vs Pre-drought 0hr

```{r DE_analysis_of_drought_6hr_vs_predrought_6hr}
dds.pt6.T6 <- DESeq(dds.pt6)
resultsNames(dds.pt6.T6) # lists the coefficients

res.T6 <- results(dds.pt6.T6, contrast = c("Condition_Time","Drought_6hr","PreDrought_6hr"))
plotMA(res.T6, ylim=c(-40,40))

summary(res.T6)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.T6, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.T6, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.T6, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
#shrink effect size
resLFC.T6 <- lfcShrink(dds.pt6.T6, coef="Condition_Time_Drought_6hr_vs_PreDrought_6hr", type="apeglm")
resLFC.T6
plotMA(resLFC.T6, ylim=c(-2,2))

summary(resLFC.T6)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.T6, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.T6, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.T6, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```


```{r export_results_drought_6hr_vs_predrought_6hr, include = FALSE}
#export results
write.csv(as.data.frame(res.T6), 
          file="../Output/Deseq2/drought-6hr-vs-predrought-6hr.csv")
write.csv(as.data.frame(resLFC.T6),
          file="../Output/Deseq2/drought-6hr-vs-predrought-6hr-lfc.csv")
```

## Drought vs. Pre-drought across different time points. (Here, pre-drought 48hr is set as reference.)
### Step 1
Create deseq2 object 

```{r}
coldata$Condition_Time <- factor(coldata$Condition_Time, c("PreDrought_0hr", "PreDrought_6hr", "PreDrought_48hr",
                                                    "Drought_0hr", "Drought_6hr", "Drought_48hr"))

coldata$Condition_Time <- relevel(coldata$Condition_Time, ref = "PreDrought_48hr")


dds.pt48 <- DESeqDataSetFromMatrix(countData = cts,
                              colData = coldata,
                              design= ~ Condition_Time + Site)
```

### Step 3a (Skip step 2, data exploration, because already performed above)
Run Deseq2 on object to find differential gene expression. Here we are comparing Drought 0hr vs Pre-drought 0hr

```{r DE_analysis_of_drought_48hr_vs_predrought_48hr}
###deifferential expression analysis###
dds.pt48.T48 <- DESeq(dds.pt48)
resultsNames(dds.pt48.T48) # lists the coefficients

res.t48 <- results(dds.pt48.T48, contrast = c("Condition_Time","Drought_48hr","PreDrought_48hr"))
plotMA(res.t48, ylim=c(-40,40))

summary(res.t48)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.t48, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.t48, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.t48, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))

```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
resLFC.t48 <- lfcShrink(dds.pt48.T48, coef="Condition_Time_Drought_48hr_vs_PreDrought_48hr", type="apeglm")
resLFC.t48
plotMA(resLFC, ylim=c(-2,2))

summary(resLFC.t48)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.t48, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.t48, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.t48, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```
```{r export_results_drought_48hr_vs_predrought_48hr, include = FALSE}
#export results
write.csv(as.data.frame(res.t48), 
          file="../Output/Deseq2/drought-48hr-vs-predrought-48hr.csv")
write.csv(as.data.frame(resLFC.t48),
          file="../Output/Deseq2/drought-48hr-vs-predrought-48hr-lfc.csv")
```

## Within drought, 6 hr compared to 0hr  (Here Drought 0h is set as reference)
### Step 1
Create deseq2 object 

```{r}
###create a deseq2 object with Condition, Time, and Site as design###
coldata$Condition_Time <- factor(coldata$Condition_Time, c("PreDrought_0hr", "PreDrought_6hr", "PreDrought_48hr",
                                                           "Drought_0hr", "Drought_6hr", "Drought_48hr"))

coldata$Condition_Time <- relevel(coldata$Condition_Time, ref = "Drought_0hr")


dds.dt0 <- DESeqDataSetFromMatrix(countData = cts,
                              colData = coldata,
                              design= ~ Condition_Time + Site)
```

### Step 3a (Skip step 2, data exploration, because already performed above)
Run Deseq2 on object to find differential gene expression. Here we are comparing Drought 6hr vs Drought 0hr

```{r}
###deifferential expression analysis###
dds.dt0.d <- DESeq(dds.dt0)
resultsNames(dds.dt0.d) # lists the coefficients

res.d.6.0 <- results(dds.dt0.d, contrast = c("Condition_Time","Drought_6hr","Drought_0hr"))
plotMA(res.d.6.0, ylim=c(-40,40))

summary(res.d.6.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.d.6.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.d.6.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.d.6.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
resLFC.d.6.0 <- lfcShrink(dds.dt0.d, coef="Condition_Time_Drought_6hr_vs_Drought_0hr", type="apeglm")
resLFC.d.6.0
plotMA(resLFC.d.6.0, ylim=c(-2,2))

summary(resLFC.d.6.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.d.6.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.d.6.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.d.6.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r}
#export results
write.csv(as.data.frame(res.d.6.0), 
          file="../Output/Deseq2/drought-6hr-vs-drought-0hr.csv")
write.csv(as.data.frame(resLFC.d.6.0),
          file="../Output/Deseq2/drought-6hr-vs-drought-0hr-lfc.csv")
```

## Within drought, 48 hr compared to 0hr  (Here Drought 0h is still set as reference, so skip to step 3a)
### Step 3a
Extract differential gene expression for comparing Drought 48hr vs Drought 0hr

```{r}
res.d.48.0 <- results(dds.dt0.d, contrast = c("Condition_Time","Drought_48hr","Drought_0hr"))
plotMA(res.d.48.0, ylim=c(-40,40))

summary(res)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res.d.48.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-40,40), ylim=c(0,40)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res.d.48.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res.d.48.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

### Step 3b
Shrink effect size using apeglm. Notice spread of log2FC decreases without the extreme outliers of log2FC > 20. 

```{r}
resLFC.d.48.0 <- lfcShrink(dds.dt0.d, coef="Condition_Time_Drought_48hr_vs_Drought_0hr", type="apeglm")
resLFC.d.48.0
plotMA(resLFC.d.48.0, ylim=c(-2,2))

summary(resLFC.d.48.0)

#make volcano plot
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLFC.d.48.0, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-15,10), ylim=c(0,25)))
with(subset(resLFC.d.48.0, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLFC.d.48.0, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r}
#export results
write.csv(as.data.frame(res.d.48.0), 
          file="../Output/Deseq2/drought-48hr-vs-drought-0hr.csv")
write.csv(as.data.frame(resLFC.d.48.0),
          file="../Output/Deseq2/drought-48hr-vs-drought-0hr-lfc.csv")
```




# Notes on observations
## Most DE occurs at T=0, before pyruvate addition. During this time, the stress difference between pre-drought and drought conditions are the greatest.
## The least DE occurs at T=6, just after pyruvate addition. This must stimulate similar microbial activity, of perhaps those that lost activity during drought, than that of pre-drought.  
## LFC tends to cause the really low Log2FC values that I have been noticing. I think using the analysis of non-LFC transformed data is best

# Next, plot heatmap of correlations between 13C/(12C + 13C) VOCs and gene expression (transcript/gene copies)
```{r}
#Extract acetate, acetone, and diacetyl genes of interest. Also, combine interest table with correlations of VOCs and gene expression from WGNCA analysis
interest <- read.csv("../../Data/Deseq2/KO_interest.csv", header = TRUE)
correlations_acetone <- read.csv("../../Data/Deseq2/gene-screening-acetone-spearman.csv", header = TRUE)
correlations_acetate <- read.csv("../../Data/Deseq2/gene-screening-acetatec2-spearman.csv", header = TRUE)
correlations_diacetyl <- read.csv("../../Data/Deseq2/gene-screening-diacetyl-spearman.csv", header = TRUE)

#create a correlation matrix between each VOC and genes of interest. Create a separate table for q values
corr_table_short <- interest %>%
  filter(Priority == "yes") %>%
  merge(correlations_acetone, by = "KO") %>%
  rename(Acetone = cor.Standard) %>%
  select(c("gene_name", "Acetone", "KO", "VOC")) %>%
  merge(correlations_acetate, by = "KO") %>%
  rename(Acetate = cor.Standard) %>%
  select(c("gene_name", "Acetone", "Acetate", "KO", "VOC")) %>%
  merge(correlations_diacetyl, by = "KO") %>%
  rename(Diacetyl = cor.Standard) %>%
  arrange(VOC) %>%
  select(c("gene_name", "Acetone", "Acetate", "Diacetyl"))

rownames(corr_table_short) <- corr_table_short$gene_name
corr_table_short$gene_name <- NULL

corr_table_short <- as.matrix(corr_table_short)

#heatmap
ggplot(data = corr_table_short, aes(x=gene_name, y= VOC, fill = corr)) +
  geom_tile()

heatmaply_cor(x = corr_table_short,
               colors = viridis)
ggsave("../../Figures/Fig3-S5-S6-Deseq2/VOC-gene-heatmap.pdf", dpi = 300, width = 4, height = 3)





```

```{r}
# create a output for table 1 in manuscript of correlations and fdr-corrected p-values
corr_table <- interest %>%
  filter(Priority == "yes") %>%
  merge(correlations_acetate, by = "KO") %>%
  rename(Acetate = cor.Standard) %>%
  rename(Acetate.p = p.Standard) %>%
  select(c("gene_name","Acetate", "Acetate.p", "KO", "VOC")) %>%
  merge(correlations_acetone, by = "KO") %>%
  rename(Acetone = cor.Standard) %>%
  rename(Acetone.p = p.Standard) %>%
  select(c("gene_name", "Acetone", "Acetone.p","Acetate", "Acetate.p", "KO", "VOC")) %>%
  merge(correlations_diacetyl, by = "KO") %>%
  rename(Diacetyl = cor.Standard) %>%
  rename(Diacetyl.p = p.Standard) %>%
  arrange(VOC) %>%
  select(c("gene_name", "Acetate", "Acetate.p", "Acetone", "Acetone.p", "Diacetyl", "Diacetyl.p"))

# Calculate FDR (BH) corretions for p-values per row
Acetate.pfdr = p.adjust(corr_table$Acetate.p, method = "BH")
Acetone.pfdr = p.adjust(corr_table$Acetone.p, method = "BH")
Diacetyl.pfdr = p.adjust(corr_table$Diacetyl.p, method = "BH")

# Add these corrected p-values to the correlation table
corr_table_fdr <- corr_table %>%
  mutate(Acetate.pfdr = Acetate.pfdr) %>%
  mutate(Acetone.pfdr = Acetone.pfdr) %>%
  mutate(Diacetyl.pfdr = Diacetyl.pfdr)

write.csv(corr_table_fdr, "../Output/corr-table-voc-gene.csv")



```


# Next, find DE of target genes involved in VOC cycling
## All time points
```{r}
##all times
as.data.frame(res) %>%
  rownames_to_column(var = "KO") %>%
  merge(interest , by = "KO") %>%
  #filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.05 & log2FoldChange > 0 ~ "Sig.D", 
                     padj < 0.05 & log2FoldChange < 0 ~ "Sig.PD")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = fct_reorder(gene_name, log2FoldChange)) %>%
  ggplot(aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  ylim(-6, 6) +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
  scale_color_manual (values = c("#2ECC71" ,"#F39C12"),
                      breaks = c("Sig.PD", "Sig.D")) +
  theme(text = element_text(size = 12,
                            
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/VOC-genes-all-times.png", dpi = 300, width = 3, height = 5)
```



###Time 0 hr

```{r}
#time 0
p1.data <- as.data.frame(res.T0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.05 & log2FoldChange > 0 ~ "Sig.D", 
                     padj < 0.05 & log2FoldChange < 0 ~ "Sig.PD")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = fct_reorder(gene_name, log2FoldChange)) 

write.csv(p1.data, "../../Output/Deseq2/drought0h-vs-predrought0h-fig3.csv")



p1 <- ggplot(p1.data, aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  ylim(-30,20) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
  scale_color_manual (values = c("#2ECC71" ,"#F39C12"),
                      breaks = c("Sig.PD", "Sig.D")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/Fig3-VOC-genes-T0.pdf", dpi = 300, width = 3, height = 5, units="in")

# return vecor with correct gene order from plot above
ordered.res.T0 <- as.data.frame(res.T0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  arrange(log2FoldChange)

ordered.VOC.vector <- ordered.res.T0$gene_name

```
###Time 6 hr
```{r}
#time 6
p2.data <- as.data.frame(res.T6) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.D", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.PD")) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p2.data, "../../Output/Deseq2/drought6h-vs-predrought6h-fig3.csv")



P2 <- ggplot(p2.data, aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  ylim(-8,8) +
  facet_wrap(~VOC,  scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
  scale_color_manual (values = c("#2ECC71" ,"#F39C12"),
                      breaks = c("Sig.PD", "Sig.D")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/Fig3-VOC-genes-T6.pdf", dpi = 300, width = 3, height = 5, units="in")
```
###Time 48 hr
```{r}
#time 48
p3.data <- as.data.frame(res.t48) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.D", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.PD")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p3.data, "../../Output/Deseq2/drought48h-vs-predrought48h-fig3.csv")


p3 <-  ggplot(aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  ylim(-8,8) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
  scale_color_manual (values = c("#2ECC71" ,"#F39C12"),
                      breaks = c("Sig.PD", "Sig.D")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/Fig3-VOC-genes-T48.pdf", dpi = 300, width = 3, height = 5, units="in")
```


```{r fig, fig.height = 6, fig.width = 6}
plot_grid(
  p1, p2, p3
)
```

###Drought 6 vs 0hr
```{r}
#time 6 vs 0 drought
p4.data <- as.data.frame(res.d.6.0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
        case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.6", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.0")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p4.data, "../../Output/Deseq2/drought6h-vs-drought0h-figS5.csv")



p4 <- ggplot(p4.data, aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  #ylim(-8,8) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
   scale_color_manual (values = c("red" ,"blue"),
                     breaks = c("Sig.0","Sig.48")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/FigS4-VOC-genes-dr-6-0.pdf", dpi = 300, width = 3, height = 5, units="in")
```
###Drought 48 vs 0hr
```{r}
p5.data <- as.data.frame(res.d.48.0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.48", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.0")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p5.data, "../../Output/Deseq2/drought48h-vs-drought0h-figS5.csv")


p5 <- ggplot(p5.data, aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  #ylim(-8,8) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
 scale_color_manual (values = c("red" ,"blue"),
                    breaks = c("Sig.0","Sig.48")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/FigS4-VOC-genes-dr-48-0.pdf", dpi = 300, width = 3, height = 5, units="in")
```

###PreDrought 6 vs 0hr
```{r}
#time 6 vs 0 drought
p6.data <- as.data.frame(res.pd.6.0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.48", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.0")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p6.data, "../../Output/Deseq2/predrought6h-vs-predrought0h-figS5.csv")



p6 <- ggplot(p6.data, aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  #ylim(-8,8) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
 scale_color_manual (values = c("red" ,"blue"),
                       breaks = c("Sig.0","Sig.48")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/FigS4-VOC-genes-pd-6-0.pdf", dpi = 300, width = 3, height = 5, units="in")
```
###PreDrought 48 vs 0hr
```{r}
p7.data <- as.data.frame(res.pd.48.0) %>%
  rownames_to_column(var = "KO") %>%
    mutate(KO = str_replace(KO, "KO:", "")) %>%
  merge(.,interest , by = "KO") %>%
  filter(Priority == "yes") %>%
  mutate(Significance =
           case_when(padj < 0.1 & log2FoldChange > 0 ~ "Sig.48", 
                     padj < 0.1 & log2FoldChange < 0 ~ "Sig.0")) %>%
  mutate(datExpr = str_replace(KO, 'KO:', '')) %>%
  mutate(gene_name = factor(gene_name, ordered.VOC.vector)) 

write.csv(p7.data, "../../Output/Deseq2/predrought48h-vs-predrought0h-figS5.csv")



p7 <- ggplot(aes(x=gene_name, y=log2FoldChange, fill = Activity, color = Significance)) +
  geom_col() +
  coord_flip() +
  theme_bw() +
  labs(y="Log-2FC") +
  #ylim(-8,8) +
  facet_wrap(~VOC, scales = "free", ncol = 1) +
  scale_fill_manual (values = c("lightgray","black"),
                     breaks = c("consume", "produce")) +
  scale_color_manual (values = c("red" ,"blue"),
                      breaks = c("Sig.0","Sig.48")) +
  theme(text = element_text(size = 12,
                            color = "black"),
        legend.title = element_blank() ,
        legend.position = "bottom",
        axis.title.y = element_blank(),
        axis.title.x = element_text(face= "bold"), 
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black", size = 10),
        axis.text.y = element_text(color = "black", size = 10))
ggsave("../../Figures/Fig3-S5-S6-Deseq2/FigS4-VOC-genes-pd-48-0.pdf", dpi = 300, width = 3, height = 5, units="in")
```
# Plot gene expression across time points
```{r}
#for figures
h=45
w=45
s=6

d <- plotCounts(dds, gene="KO:K00156", intgroup=c("Condition", "Time"),
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))



ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K00156:poxB") +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme_bw() +
  theme(text = element_text(size = s,
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K00156.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K00158", intgroup=c("Condition", "Time"),
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K00158:poxL") +
  theme_bw() +
  theme(text = element_text(size = s,
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K00158.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K01067", intgroup=c("Condition", "Time"),
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K01067:ACH1") +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme_bw() +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K01067.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K01026", intgroup=c("Condition", "Time"),
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K01026:pct") +
  theme_bw() +
  
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K01026.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K18118", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K18118:aarC") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K18118.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K01895", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K01895:acs") +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme_bw() +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K01895.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K00925", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K00925:ackA") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K00925.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K01512", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  labs(title = "K01512:acyP") +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme_bw() +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black",face = "bold"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K01512.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

##acetone 
d <- plotCounts(dds, gene="KO:K01574", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K01574:adc") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K01574.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K18382", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K18382:adh1") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K18382.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K18371", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K18371:acmA") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K18371.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K10854", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K10854:acxB") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K10854.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K10855", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K10855:acxA") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K10855.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)

d <- plotCounts(dds, gene="KO:K10856", intgroup=c("Condition", "Time"), 
                returnData=TRUE)
d$Time <- factor(d$Time, levels=c("0hr", "6hr", "48hr"))


ggplot(d, aes(x=Time, y=count, fill = Condition)) + 
  geom_point() + geom_boxplot() + 
  facet_grid(~Condition) +
  scale_y_log10() +
  scale_fill_manual (values = col_list2) +
  #scale_x_discrete(labels = c("0", "6", "48")) +
  labs(title = "K10856:acxC") +
  theme_bw() +
  scale_x_discrete(breaks=c("0hr", "6hr", "48hr"),
    labels=c("0h", "6h", "48h")) +
  theme(text = element_text(size = s,
                            
                            color = "black"),
        axis.title.x = element_blank(),
        axis.title.y = element_text(face = "bold"),
        axis.text.x = element_text(vjust = 1, hjust = 0.5, color = "black"),
        axis.text.y = element_text(color = "black"),
        legend.position = "none")
filename=paste("../../Figures/Fig3-S5-S6-Deseq2/FigS6-K10856.pdf", sep = "")
ggsave(filename ,width=w, height=h, units='mm', dpi = 300)


```

